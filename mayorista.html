function recalcular(){
  // 1. Calcular total de unidades de TODOS los productos
  let totalUnidades = 0;
  document.querySelectorAll("#body tr").forEach(tr => {
    totalUnidades += Number(tr.querySelector("input").value || 0);
  });

  // 2. Determinar nivel global
  let esMayorista12Mas = totalUnidades >= 12;
  let esMayorista6a11 = totalUnidades >= 6 && totalUnidades < 12;

  // 3. Calcular total
  let total = 0;

  document.querySelectorAll("#body tr").forEach(tr => {
    const prodSelect = tr.children[1].querySelector("select");
    const prod = prodSelect ? prodSelect.value : "";
    const qty = Number(tr.querySelector("input").value || 0);
    
    if (!prod || qty <= 0) {
      tr.children[3].textContent = "₡0";
      tr.children[4].textContent = "₡0";
      return;
    }

    // Buscar datos del producto - IMPORTANTE: verifica los nombres de propiedades
    const fila = productos.find(p => p.producto === prod);
    if (!fila) {
      tr.children[3].textContent = "₡0";
      tr.children[4].textContent = "₡0";
      return;
    }

    // DEPURACIÓN: Ver qué datos tiene la fila
    console.log("Producto encontrado:", fila);
    
    // 4. DECISIÓN DE PRECIO
    let precioUnit;
    
    // Asegúrate que los nombres de propiedades coincidan con tu API
    if (qty >= 24 && fila.precio_24) {
      precioUnit = fila.precio_24;
    }
    else if (esMayorista12Mas && fila.precio_12) {
      precioUnit = fila.precio_12;
    }
    else if (esMayorista6a11 && fila.precio_6_11) {
      precioUnit = fila.precio_6_11;
    }
    else {
      // Si no califica para mayorista, usar precio normal
      precioUnit = fila.precio_6_11 || 0;
    }

    // Mostrar precios
    tr.children[3].textContent = "₡" + (precioUnit || 0).toLocaleString("es-CR");
    tr.children[4].textContent = "₡" + (fila.precio_6_11 || 0).toLocaleString("es-CR");

    // Sumar al total
    total += (precioUnit || 0) * qty;
  });

  // 5. Actualizar totales
  document.getElementById("tU").textContent = totalUnidades;
  document.getElementById("tT").textContent = "₡" + total.toLocaleString("es-CR");
}
