function recalcular(){
  // 1. Calcular total de unidades de TODOS los productos
  let totalUnidades = 0;
  document.querySelectorAll("#body tr").forEach(tr => {
    totalUnidades += Number(tr.querySelector("input").value || 0);
  });

  // 2. Determinar nivel mayorista GLOBAL basado en TODAS las unidades
  let nivelGlobal = "individual"; // menos de 6 unidades
  if (totalUnidades >= 24) nivelGlobal = "24";
  else if (totalUnidades >= 12) nivelGlobal = "12";
  else if (totalUnidades >= 6) nivelGlobal = "6_11";

  // 3. Calcular total y aplicar precios
  let total = 0;

  document.querySelectorAll("#body tr").forEach(tr => {
    const prodSelect = tr.children[1].querySelector("select");
    const prod = prodSelect ? prodSelect.value : "";
    const qty = Number(tr.querySelector("input").value || 0);
    
    if (!prod || qty <= 0) {
      tr.children[3].textContent = "₡0";
      tr.children[4].textContent = "₡0";
      return;
    }

    // Buscar datos del producto
    const fila = productos.find(p => p.producto === prod);
    if (!fila) {
      tr.children[3].textContent = "₡0";
      tr.children[4].textContent = "₡0";
      return;
    }

    // 4. DECISIÓN DE PRECIO (la lógica correcta)
    let precioUnit;
    
    // REGLA 1: Si tiene 24+ unidades del MISMO producto
    if (qty >= 24) {
      precioUnit = fila.precio_24;
    }
    // REGLA 2: Si no, usar nivel global
    else if (nivelGlobal === "12") {
      precioUnit = fila.precio_12;
    }
    else if (nivelGlobal === "6_11") {
      precioUnit = fila.precio_6_11;
    }
    else {
      // Menos de 6 unidades en total - no califica como mayorista
      // Aquí puedes decidir qué mostrar
      precioUnit = fila.precio_6_11; // o podrías poner 0 o otro precio
    }

    // Mostrar precios
    tr.children[3].textContent = "₡" + precioUnit.toLocaleString("es-CR");
    tr.children[4].textContent = "₡" + fila.precio_6_11.toLocaleString("es-CR");

    // Sumar al total
    total += precioUnit * qty;
  });

  // 5. Actualizar totales
  document.getElementById("tU").textContent = totalUnidades;
  document.getElementById("tT").textContent = "₡" + total.toLocaleString("es-CR");
}
